<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LogChimp Enhanced Feedback System</title>
    <style>
        /* 
         * DESIGN SYSTEM & VARIABLES 
         */
        :root {
            /* Color Palette */
            --primary-blue: #3b82f6;
            --primary-dark: #2563eb;
            --success-green: #10b981;
            --warning-yellow: #f59e0b;
            --error-red: #ef4444;
            --info-purple: #8b5cf6;
            
            /* Neutrals */
            --bg-body: #f3f4f6;
            --bg-card: #ffffff;
            --text-main: #111827;
            --text-secondary: #6b7280;
            --border-light: #e5e7eb;
            
            /* Spacing & Shadows */
            --radius-md: 12px;
            --radius-lg: 16px;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            
            --container-width: 1200px;
        }

        /* RESET & BASE STYLES */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        
        body {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            color: var(--text-main);
            min-height: 100vh;
            padding-bottom: 40px;
            -webkit-font-smoothing: antialiased;
        }

        button { cursor: pointer; border: none; background: none; font-size: 1rem; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        a { text-decoration: none; color: var(--primary-blue); font-weight: 500; }
        ul { list-style: none; }
        select, input, textarea { outline: none; }

        /* LAYOUT UTILITIES */
        .container {
            max-width: var(--container-width);
            margin: 0 auto;
            padding: 0 20px;
        }

        .flex { display: flex; align-items: center; }
        .flex-col { flex-direction: column; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        .gap-4 { gap: 16px; }

        /* HEADER */
        header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-light);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 16px 0;
        }
        
        .logo { font-size: 1.25rem; font-weight: 700; color: var(--text-main); display: flex; align-items: center; gap: 8px; }
        .logo span { color: var(--primary-blue); }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
            padding: 10px 20px;
            border-radius: var(--radius-md);
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3);
        }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-1px); box-shadow: 0 6px 8px -1px rgba(59, 130, 246, 0.4); }
        .btn-primary:active { transform: translateY(0); }

        .btn-secondary {
            background: white;
            color: var(--text-main);
            border: 1px solid var(--border-light);
            padding: 8px 16px;
            border-radius: var(--radius-md);
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        .btn-secondary:hover { background: #f9fafb; border-color: #d1d5db; }

        /* STATS DASHBOARD */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 24px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-light);
            transition: all 0.2s ease;
        }
        .stat-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); border-color: var(--primary-blue); }
        
        .stat-value { font-size: 2rem; font-weight: 700; color: var(--text-main); margin: 8px 0; }
        .stat-label { color: var(--text-secondary); font-size: 0.9rem; font-weight: 500; }
        .stat-icon { 
            position: absolute; top: 20px; right: 20px; width: 40px; height: 40px; 
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            background: #eff6ff; color: var(--primary-blue);
        }

        /* CONTROLS BAR */
        .controls-bar {
            background: var(--bg-card);
            padding: 16px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            margin-bottom: 24px;
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            align-items: center;
            justify-content: space-between;
            border: 1px solid var(--border-light);
        }

        .filter-tabs { display: flex; gap: 6px; background: var(--bg-body); padding: 4px; border-radius: 10px; }
        .filter-tab {
            padding: 8px 16px;
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }
        .filter-tab:hover { color: var(--text-main); background: rgba(255,255,255,0.5); }
        .filter-tab.active { background: white; color: var(--primary-blue); shadow: var(--shadow-sm); font-weight: 600; box-shadow: var(--shadow-sm); }

        /* FEEDBACK GRID */
        .feedback-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 24px;
        }

        /* ENHANCED POST ITEM (Card Component) */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            padding: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .card:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-lg);
            border-color: #bfdbfe;
        }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; }
        
        .card-title { font-size: 1.125rem; font-weight: 600; line-height: 1.4; color: var(--text-main); margin-bottom: 4px; }
        .card-meta { font-size: 0.85rem; color: var(--text-secondary); display: flex; align-items: center; gap: 6px; }

        .card-body { flex-grow: 1; margin-bottom: 12px; }
        .card-desc { color: #4b5563; font-size: 0.95rem; line-height: 1.6; margin-bottom: 12px; }
        
        .card-image-container {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 8px;
            border: 1px solid var(--border-light);
            position: relative;
            background: #f3f4f6;
        }
        .card-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .card-image:hover { transform: scale(1.02); }
        
        .expand-badge {
            position: absolute;
            top: 8px; right: 8px;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            backdrop-filter: blur(4px);
            pointer-events: none;
        }

        .card-footer { display: flex; justify-content: space-between; align-items: center; margin-top: auto; padding-top: 16px; border-top: 1px solid var(--border-light); }

        /* BADGES */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .badge.feature { background: #eff6ff; color: #3b82f6; }
        .badge.bug { background: #fef2f2; color: #ef4444; }
        .badge.enhancement { background: #f5f3ff; color: #8b5cf6; }
        .badge.planned { background: #fffbeb; color: #f59e0b; }
        .badge.completed { background: #ecfdf5; color: #10b981; }
        .badge.open { background: #f3f4f6; color: #6b7280; }
        .badge.in-progress { background: #eff6ff; color: #3b82f6; }

        /* Priority Badge */
        .priority-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 6px;
            background: var(--bg-body);
        }
        .priority-dot { width: 6px; height: 6px; border-radius: 50%; }
        .p-critical .priority-dot { background: var(--error-red); box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2); }
        .p-critical { color: var(--error-red); }
        .p-high .priority-dot { background: var(--warning-yellow); box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2); }
        .p-high { color: var(--warning-yellow); }
        .p-medium .priority-dot { background: var(--primary-blue); box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); }
        .p-medium { color: var(--primary-blue); }
        .p-low .priority-dot { background: var(--success-green); }
        .p-low { color: var(--text-secondary); }

        /* ENHANCED VOTE COMPONENT */
        .vote-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 52px;
            height: 52px;
            background: var(--bg-body);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            position: relative;
            overflow: visible;
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .vote-btn:hover { background: #e0e7ff; color: var(--primary-blue); transform: scale(1.05); }
        .vote-btn.voted { background: var(--primary-blue); color: white; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.5); transform: scale(1.1); }
        .vote-count { font-weight: 700; font-size: 1.1rem; }
        .vote-label { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.5px; margin-top: -2px; }

        /* Particles */
        .particle {
            position: fixed;
            pointer-events: none;
            width: 8px; height: 8px;
            border-radius: 50%;
            background: var(--primary-blue);
            opacity: 0;
            z-index: 9999;
        }
        @keyframes particle-fly {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }

        /* ONBOARDING CARD COMPONENT */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }

        /* Shared Modal Styles */
        .modal-content {
            background: white;
            width: 90%;
            max-width: 600px;
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transform: scale(0.9) translateY(20px);
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: none;
        }
        .modal-overlay.active .modal-content { display: block; transform: scale(1) translateY(0); }

        /* NEW FEEDBACK FORM MODAL */
        .feedback-modal-header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .feedback-modal-body { padding: 32px; }
        
        .form-group { margin-bottom: 24px; }
        .form-label { display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-main); font-size: 0.9rem; }
        
        .type-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        .type-option {
            border: 2px solid var(--border-light);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .type-option:hover { border-color: #bfdbfe; background: #f9fafb; }
        .type-option.selected { border-color: var(--primary-blue); background: #eff6ff; }
        .type-option.selected .type-icon { color: var(--primary-blue); }
        
        .type-icon { display: block; margin-bottom: 8px; color: var(--text-secondary); }
        .type-name { font-weight: 600; font-size: 0.9rem; }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        .form-input:focus { border-color: var(--primary-blue); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .form-input.error { border-color: var(--error-red); }
        .error-msg { color: var(--error-red); font-size: 0.85rem; margin-top: 6px; display: none; }
        
        /* Attachment Area */
        .attachment-area {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .preview-container {
            display: none;
            position: relative;
            margin-top: 16px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border-light);
        }
        .preview-container.active { display: block; }
        
        .preview-image {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            background: #f3f4f6;
            display: block;
        }
        
        .remove-image-btn {
            position: absolute;
            top: 8px; right: 8px;
            background: rgba(0,0,0,0.6);
            color: white;
            border-radius: 50%;
            width: 28px; height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        .remove-image-btn:hover { background: var(--error-red); }

        .feedback-modal-footer {
            padding: 24px 32px;
            background: #f9fafb;
            border-radius: 0 0 24px 24px;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Onboarding Specific */
        .onboarding-card { padding: 48px; text-align: center; max-width: 650px; }
        .onboarding-steps { display: flex; justify-content: space-between; margin: 40px 0; position: relative; }
        .onboarding-steps::before {
            content: ''; position: absolute; top: 24px; left: 0; right: 0; height: 3px;
            background: var(--border-light); z-index: 0;
        }
        .step-item {
            position: relative; z-index: 1;
            display: flex; flex-direction: column; align-items: center; gap: 12px;
            background: white; padding: 0 10px;
        }
        .step-circle {
            width: 50px; height: 50px; border-radius: 50%; background: var(--bg-body);
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; color: var(--text-secondary); border: 3px solid white;
            box-shadow: var(--shadow-sm); font-size: 1.1rem;
        }
        .step-text { font-size: 0.85rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; }
        .step-item.highlight .step-circle { background: var(--primary-blue); color: white; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2); }
        .step-item.highlight .step-text { color: var(--primary-blue); }

        /* TOAST */
        .toast-container { position: fixed; bottom: 30px; right: 30px; z-index: 2000; display: flex; flex-direction: column; gap: 12px; }
        .toast {
            background: var(--text-main); color: white; padding: 14px 24px;
            border-radius: var(--radius-md); box-shadow: var(--shadow-lg);
            display: flex; align-items: center; gap: 12px;
            transform: translateX(120%); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            min-width: 300px;
        }
        .toast.show { transform: translateX(0); }
        .toast-success { border-left: 4px solid var(--success-green); }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: 1fr; }
            .controls-bar { flex-direction: column; align-items: stretch; }
            .filter-tabs { width: 100%; overflow-x: auto; padding-bottom: 8px; }
            .onboarding-card { padding: 30px 20px; }
            .type-selector { grid-template-columns: 1fr; }
            .feedback-modal-footer { flex-direction: column-reverse; }
            .btn-primary, .btn-secondary { width: 100%; justify-content: center; }
            .attachment-area { flex-direction: column; }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <div class="container flex justify-between">
            <div class="logo">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="2" y="4" width="20" height="16" rx="4" fill="#3b82f6" fill-opacity="0.15"/>
                    <path d="M8 10H16M8 14H13" stroke="#3b82f6" stroke-width="2.5" stroke-linecap="round"/>
                </svg>
                LogChimp <span style="font-size: 0.8em; background: #dbeafe; color: #1e40af; padding: 2px 6px; border-radius: 4px;">v2.0</span>
            </div>
            <div class="flex gap-4">
                <button class="btn-primary" id="addFeedbackBtn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    New Feedback
                </button>
            </div>
        </div>
    </header>

    <main class="container">
        
        <!-- Statistics Dashboard Component -->
        <section class="stats-grid" id="statsContainer">
            <!-- Injected via JS -->
        </section>

        <!-- Filter & Controls -->
        <section class="controls-bar">
            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="all">All</button>
                <button class="filter-tab" data-filter="feature">Features</button>
                <button class="filter-tab" data-filter="bug">Bugs</button>
                <button class="filter-tab" data-filter="enhancement">Enhancements</button>
            </div>
            <div class="flex gap-2" style="color: var(--text-secondary); font-size: 0.9rem;">
                <span>Sort by:</span>
                <select id="sortSelect" style="padding: 6px 10px; border-radius: 6px; border: 1px solid var(--border-light); font-weight: 500; color: var(--text-main);">
                    <option value="votes">Most Votes</option>
                    <option value="newest">Newest</option>
                </select>
            </div>
        </section>

        <!-- Feedback Grid Component -->
        <section class="feedback-grid" id="feedbackList">
            <!-- Cards Injected via JS -->
        </section>
    </main>

    <!-- NEW FEEDBACK MODAL -->
    <div class="modal-overlay" id="newFeedbackModal">
        <div class="modal-content feedback-modal">
            <div class="feedback-modal-header">
                <h3 style="font-size: 1.25rem; font-weight: 700;">Add New Feedback</h3>
                <button onclick="closeFeedbackModal()" style="padding: 4px; border-radius: 4px; color: var(--text-secondary);">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="feedback-modal-body">
                <form id="feedbackForm" onsubmit="handleFeedbackSubmit(event)">
                    <!-- Type Selection -->
                    <div class="form-group">
                        <label class="form-label">Feedback Type</label>
                        <div class="type-selector">
                            <div class="type-option selected" onclick="selectType('feature', this)">
                                <span class="type-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>
                                </span>
                                <span class="type-name">Feature</span>
                            </div>
                            <div class="type-option" onclick="selectType('bug', this)">
                                <span class="type-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                                </span>
                                <span class="type-name">Bug</span>
                            </div>
                            <div class="type-option" onclick="selectType('enhancement', this)">
                                <span class="type-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                                </span>
                                <span class="type-name">Enhancement</span>
                            </div>
                        </div>
                    </div>

                    <!-- Title Input -->
                    <div class="form-group">
                        <label class="form-label" for="fbTitle">Title</label>
                        <input type="text" id="fbTitle" class="form-input" placeholder="Short summary of your idea..." autocomplete="off">
                        <div class="error-msg" id="titleError">Title is required</div>
                    </div>

                    <!-- Description Input -->
                    <div class="form-group">
                        <label class="form-label" for="fbDesc">Description</label>
                        <textarea id="fbDesc" class="form-input" rows="4" placeholder="Describe the details..."></textarea>
                    </div>

                    <!-- Attachments (NEW) -->
                    <div class="form-group">
                        <label class="form-label">Attachments (Optional)</label>
                        <div class="attachment-area">
                            <!-- File Upload -->
                            <label class="btn-secondary" style="flex: 1; justify-content: center;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                                Upload Image
                                <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(this)">
                            </label>
                            
                            <!-- Screenshot Button -->
                            <button type="button" class="btn-secondary" style="flex: 1; justify-content: center;" onclick="takeScreenshot()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
                                Take Screenshot
                            </button>
                        </div>
                        
                        <!-- Preview -->
                        <div class="preview-container" id="imagePreviewContainer">
                            <span class="remove-image-btn" onclick="removeImage()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                            </span>
                            <img id="imagePreview" class="preview-image" src="" alt="Preview">
                        </div>
                    </div>
                </form>
            </div>
            <div class="feedback-modal-footer">
                <button class="btn-secondary" onclick="closeFeedbackModal()">Cancel</button>
                <button class="btn-primary" onclick="submitFeedbackForm()">Submit Feedback</button>
            </div>
        </div>
    </div>

    <!-- Onboarding Modal Component -->
    <div class="modal-overlay" id="onboardingModal">
        <div class="modal-content onboarding-card">
            <div style="margin-bottom: 16px;">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2">
                    <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3L6.91 6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                </svg>
            </div>
            <h2 style="font-size: 1.8rem; margin-bottom: 12px;">Welcome to LogChimp 2.0</h2>
            <p style="color: var(--text-secondary); font-size: 1.1rem; margin-bottom: 24px;">
                We've completely redesigned our feedback system to be smarter and more interactive.
            </p>

            <div class="onboarding-steps">
                <div class="step-item">
                    <div class="step-circle">1</div>
                    <div class="step-text">Submit</div>
                </div>
                <div class="step-item highlight">
                    <div class="step-circle">2</div>
                    <div class="step-text">Vote</div>
                </div>
                <div class="step-item">
                    <div class="step-circle">3</div>
                    <div class="step-text">Track</div>
                </div>
            </div>

            <div style="text-align: left; background: #f9fafb; padding: 20px; border-radius: 12px; margin-bottom: 32px; border: 1px dashed var(--border-light);">
                <div class="flex gap-4">
                    <div style="min-width: 24px;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 6px; font-weight: 600;">Smart Auto-Prioritization</h4>
                        <p style="font-size: 0.95rem; color: #4b5563;">
                            Badges now automatically update based on community votes. If an idea hits 50+ votes, it becomes <span style="color: var(--error-red); font-weight: 600;">Critical</span>. Help us prioritize what matters most!
                        </p>
                    </div>
                </div>
            </div>

            <button class="btn-primary" style="width: 100%; justify-content: center; padding: 14px; font-size: 1.1rem;" onclick="closeOnboarding()">
                Got it, let's explore!
            </button>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // --- MOCK DATABASE ---
        const initialData = [
            {
                id: 1,
                title: "Dark Mode Support",
                description: "It would be great to have a dark mode option for the dashboard to reduce eye strain during night work sessions. Implementing system preference detection would be ideal.",
                type: "feature",
                status: "planned",
                votes: 42,
                author: "Alex M.",
                date: "2024-12-20",
                image: "https://picsum.photos/seed/darkmode/600/400.jpg"
            },
            {
                id: 2,
                title: "Export Reports to CSV/PDF",
                description: "Ability to export feedback reports and detailed statistics for monthly stakeholder meetings. Needs to include vote history and comments.",
                type: "enhancement",
                status: "in-progress",
                votes: 18,
                author: "Sarah J.",
                date: "2024-12-22"
            },
            {
                id: 3,
                title: "Login fails on Safari iOS",
                description: "Authentication loop occurs when trying to log in using Safari browser on iOS 15.4. Clears cookies but persists. Very critical for mobile users.",
                type: "bug",
                status: "open",
                votes: 8,
                author: "Mike T.",
                date: "2024-12-25",
                image: "https://picsum.photos/seed/bug1/600/400.jpg"
            },
            {
                id: 4,
                title: "Slack Integration",
                description: "Send notifications to a specific Slack channel when a status changes to 'Completed' or when new feedback is submitted in a specific category.",
                type: "feature",
                status: "completed",
                votes: 65,
                author: "Jessica L.",
                date: "2024-12-10"
            },
            {
                id: 5,
                title: "API Rate Limiting Too Strict",
                description: "The API returns 429 errors too frequently even with low usage. Please review limits or implement a tiered system for enterprise users.",
                type: "bug",
                status: "open",
                votes: 3,
                author: "DevOps Team",
                date: "2024-12-26"
            },
            {
                id: 6,
                title: "Search Filter improvements",
                description: "Current search is very basic. We need to filter by date range, vote count, and combine tags (AND/OR logic).",
                type: "enhancement",
                status: "planned",
                votes: 22,
                author: "Product Owner",
                date: "2024-12-24"
            }
        ];

        // --- APP STATE ---
        let feedbackData = [...initialData].map(item => ({ ...item, votedByMe: false }));
        let activeFilter = 'all';
        let selectedFeedbackType = 'feature';
        let currentAttachment = null; // Stores Base64 string

        // --- UTILS ---
        
        function getPriority(votes) {
            if (votes >= 50) return { label: 'Critical', class: 'p-critical' };
            if (votes >= 20) return { label: 'High', class: 'p-high' };
            if (votes >= 5) return { label: 'Medium', class: 'p-medium' };
            return { label: 'Low', class: 'p-low' };
        }

        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        // --- COMPONENT RENDERERS ---

        function renderStats() {
            const container = document.getElementById('statsContainer');
            const total = feedbackData.length;
            const bugs = feedbackData.filter(i => i.type === 'bug').length;
            const features = feedbackData.filter(i => i.type === 'feature').length;
            const totalVotes = feedbackData.reduce((acc, curr) => acc + curr.votes, 0);

            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                    </div>
                    <div class="stat-label">Total Feedback</div>
                    <div class="stat-value">${total}</div>
                    <div style="font-size:0.8rem; color: #10b981; font-weight: 500;">+2 new today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="color: #8b5cf6; background: #f5f3ff;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path></svg>
                    </div>
                    <div class="stat-label">Community Votes</div>
                    <div class="stat-value">${totalVotes}</div>
                    <div style="font-size:0.8rem; color: var(--text-secondary);">High engagement</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="color: #ef4444; background: #fef2f2;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                    </div>
                    <div class="stat-label">Open Bugs</div>
                    <div class="stat-value">${bugs}</div>
                    <div style="font-size:0.8rem; color: ${bugs > 0 ? '#ef4444' : '#10b981'};">${bugs > 0 ? 'Needs attention' : 'System Stable'}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="color: #f59e0b; background: #fffbeb;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                    </div>
                    <div class="stat-label">Planned Features</div>
                    <div class="stat-value">${features}</div>
                    <div style="font-size:0.8rem; color: var(--text-secondary);">Next release</div>
                </div>
            `;
        }

        function renderFeedback() {
            const container = document.getElementById('feedbackList');
            container.innerHTML = '';

            let items = feedbackData;
            if (activeFilter !== 'all') {
                items = items.filter(item => item.type === activeFilter);
            }

            const sortMode = document.getElementById('sortSelect').value;
            items.sort((a, b) => {
                if (sortMode === 'votes') return b.votes - a.votes;
                if (sortMode === 'newest') return new Date(b.date) - new Date(a.date);
                return 0;
            });

            if (items.length === 0) {
                container.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-secondary);">No feedback found.</div>`;
                return;
            }

            items.forEach(item => {
                const priority = getPriority(item.votes);
                
                const card = document.createElement('article');
                card.className = 'card';
                card.setAttribute('role', 'article');
                card.setAttribute('aria-label', `Feedback item: ${item.title}`);

                let imageHTML = '';
                if (item.image) {
                    imageHTML = `
                        <div class="card-image-container">
                            <div class="expand-badge">Image Attached</div>
                            <img src="${item.image}" class="card-image" alt="Attachment for ${item.title}" onclick="openImage('${item.image}')">
                        </div>
                    `;
                }

                card.innerHTML = `
                    <div class="card-header">
                        <div style="flex-grow:1;">
                            <div class="flex gap-2" style="margin-bottom: 8px;">
                                <span class="badge ${item.type}">${item.type}</span>
                                <span class="badge ${item.status}">${item.status.replace('-', ' ')}</span>
                            </div>
                            <h3 class="card-title">${item.title}</h3>
                        </div>
                    </div>
                    
                    <div class="card-body">
                        <p class="card-desc">${item.description}</p>
                        ${imageHTML}
                    </div>

                    <div class="card-footer">
                        <div class="flex gap-4" style="flex-wrap: wrap; gap: 8px;">
                            <div class="card-meta">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                                <span>${item.author}</span>
                            </div>
                             <div class="priority-badge ${priority.class}" title="Priority based on votes">
                                <div class="priority-dot"></div>
                                ${priority.label}
                            </div>
                        </div>
                        
                        <button class="vote-btn ${item.votedByMe ? 'voted' : ''}" 
                                onclick="handleVote(${item.id}, this)"
                                aria-label="Vote for ${item.title}">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="margin-bottom: 2px;"><path d="M18 15l-6-6-6 6"/></svg>
                            <span class="vote-count">${item.votes}</span>
                            <span class="vote-label">Vote</span>
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // --- IMAGE HANDLING (UPLOAD & SCREENSHOT) ---

        function handleImageUpload(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    setAttachment(e.target.result);
                }
                
                reader.readAsDataURL(file);
            }
        }

        async function takeScreenshot() {
            try {
                // Request screen stream
                const stream = await navigator.mediaDevices.getDisplayMedia({
                    video: { cursor: "always" },
                    audio: false
                });

                const videoTrack = stream.getVideoTracks()[0];
                const video = document.createElement('video');
                video.srcObject = stream;
                
                // Wait for video to load metadata and play
                await video.play();

                // Create a canvas to capture the frame
                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext('2d');
                
                // Draw current video frame
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // Stop the stream immediately (user sees the browser UI to select, then we snap)
                stream.getTracks().forEach(track => track.stop());

                // Convert to Data URL
                const dataUrl = canvas.toDataURL('image/png');
                setAttachment(dataUrl);
                showToast("Screenshot captured!");

            } catch (err) {
                console.error("Error taking screenshot:", err);
                // User likely cancelled or browser doesn't support it
                if(err.name !== 'NotAllowedError') {
                    showToast("Could not capture screen");
                }
            }
        }

        function setAttachment(dataUrl) {
            currentAttachment = dataUrl;
            const previewContainer = document.getElementById('imagePreviewContainer');
            const previewImg = document.getElementById('imagePreview');
            
            previewImg.src = dataUrl;
            previewContainer.classList.add('active');
        }

        function removeImage() {
            currentAttachment = null;
            document.getElementById('imagePreviewContainer').classList.remove('active');
            document.getElementById('imageUpload').value = ''; // Reset file input
        }

        function openImage(src) {
            const w = window.open("");
            w.document.write(`<img src="${src}" style="max-width:100%">`);
        }

        // --- FEEDBACK MODAL LOGIC ---

        document.getElementById('addFeedbackBtn').addEventListener('click', () => {
            const modal = document.getElementById('newFeedbackModal');
            modal.classList.add('active');
            // Reset form
            document.getElementById('fbTitle').value = '';
            document.getElementById('fbDesc').value = '';
            document.getElementById('titleError').style.display = 'none';
            document.getElementById('fbTitle').classList.remove('error');
            removeImage(); // Clear image
            
            // Reset Type Selection
            selectedFeedbackType = 'feature';
            updateTypeSelectionUI();
        });

        function closeFeedbackModal() {
            document.getElementById('newFeedbackModal').classList.remove('active');
        }

        function selectType(type, element) {
            selectedFeedbackType = type;
            updateTypeSelectionUI(element);
        }

        function updateTypeSelectionUI(activeElement) {
            const options = document.querySelectorAll('.type-option');
            options.forEach(opt => opt.classList.remove('selected'));
            if (activeElement) {
                activeElement.classList.add('selected');
            } else {
                // Default select the first one (Feature)
                document.querySelector('.type-option').classList.add('selected');
            }
        }

        function submitFeedbackForm() {
            const titleInput = document.getElementById('fbTitle');
            const descInput = document.getElementById('fbDesc');
            const title = titleInput.value.trim();
            const desc = descInput.value.trim();

            // Validation
            if (!title) {
                titleInput.classList.add('error');
                document.getElementById('titleError').style.display = 'block';
                return;
            }

            // Create Object
            const newItem = {
                id: Date.now(),
                title: title,
                description: desc || "No description provided.",
                type: selectedFeedbackType,
                status: "open",
                votes: 0,
                votedByMe: false,
                author: "Guest User",
                date: new Date().toISOString().split('T')[0],
                image: currentAttachment // Add image if exists
            };

            // Update State
            feedbackData.unshift(newItem);
            
            // Re-render
            renderStats();
            renderFeedback();
            
            // Close & Feedback
            closeFeedbackModal();
            showToast("Feedback submitted successfully!");
        }

        // --- VOTING LOGIC ---

        function handleVote(id, btnElement) {
            const item = feedbackData.find(i => i.id === id);
            if (!item) return;

            if (item.votedByMe) {
                item.votes--;
                item.votedByMe = false;
                btnElement.classList.remove('voted');
            } else {
                item.votes++;
                item.votedByMe = true;
                btnElement.classList.add('voted');
                triggerParticles(btnElement);
                showToast(`Vote recorded for "${item.title}"`);
            }

            btnElement.querySelector('.vote-count').textContent = item.votes;
            
            if (window.renderTimeout) clearTimeout(window.renderTimeout);
            window.renderTimeout = setTimeout(() => {
                renderStats(); 
                renderFeedback();
            }, 400);
        }

        function triggerParticles(btn) {
            const rect = btn.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                document.body.appendChild(particle);

                const angle = (Math.PI * 2 * i) / 8;
                const velocity = 30 + Math.random() * 20;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity - 20;

                particle.style.left = `${centerX}px`;
                particle.style.top = `${centerY}px`;
                particle.style.setProperty('--tx', `${tx}px`);
                particle.style.setProperty('--ty', `${ty}px`);
                
                const colors = ['#3b82f6', '#60a5fa', '#93c5fd', '#ffffff'];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];

                particle.style.animation = `particle-fly 0.6s ease-out forwards`;

                setTimeout(() => particle.remove(), 600);
            }
        }

        function showToast(message) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'toast toast-success';
            toast.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                <span>${message}</span>
            `;
            container.appendChild(toast);
            
            requestAnimationFrame(() => toast.classList.add('show'));

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 400);
            }, 3000);
        }

        // --- EVENT LISTENERS ---
        document.querySelectorAll('.filter-tab').forEach(tab => {
            tab.addEventListener('click', (e) => {
                document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                e.target.classList.add('active');
                activeFilter = e.target.dataset.filter;
                renderFeedback();
            });
        });

        document.getElementById('sortSelect').addEventListener('change', renderFeedback);

        // --- ONBOARDING LOGIC ---
        function checkOnboarding() {
            const hasSeen = localStorage.getItem('logchimp_onboarded_v2');
            if (!hasSeen) {
                setTimeout(() => {
                    document.getElementById('onboardingModal').classList.add('active');
                }, 500);
            }
        }

        window.closeOnboarding = function() {
            document.getElementById('onboardingModal').classList.remove('active');
            localStorage.setItem('logchimp_onboarded_v2', 'true');
        }

        // --- INITIALIZATION ---
        window.addEventListener('DOMContentLoaded', () => {
            renderStats();
            renderFeedback();
            checkOnboarding();
        });

    </script>
</body>
</html>